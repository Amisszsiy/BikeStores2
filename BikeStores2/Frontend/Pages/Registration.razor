@page "/ProductOrder"
@using BikeStores2.Domain.Models
@rendermode InteractiveServer

<Page>
    <Card>
        <CardHeader>
            <CardTitle>
                Select Product
            </CardTitle>
        </CardHeader>
        <CardBody>
            <SelectBrand brands="brandList" BrandEvent="FilterProduct" />
            <SelectProduct products="filteredProducts" ProductEvent="SetSelectProduct" />
        </CardBody>
    </Card>
</Page>

@code {
    protected List<Brand> brandList { get; set; }

    protected List<Product> productList { get; set; }
    protected List<Product> filteredProducts { get; set; }

    public Brand? Brand { get; set; }
    public Product? Product { get; set; }

    protected override async Task OnInitializedAsync()
    {
        using(HttpClient client = new HttpClient())
        {
            HttpResponseMessage res = await client.GetAsync("https://localhost:7217/getbrandlistasync");
            brandList = await res.Content.ReadFromJsonAsync<List<Brand>>();
        }

        using (HttpClient client = new HttpClient())
        {
            HttpResponseMessage res = await client.GetAsync("https://localhost:7217/getproducts");
            productList = await res.Content.ReadFromJsonAsync<List<Product>>();
            filteredProducts = productList;
        }
    }

    public void FilterProduct(Brand brand)
    {
        Brand = brand;
        filteredProducts = productList.Where(p => p.brand_id == brand.Id).ToList();
    }

    public void SetSelectProduct(Product product)
    {
        Product = product;
        if(Brand != null)
        {
            Console.WriteLine($"Brand : {Brand.Name}, Product : {Product.product_name}");
        }
    }
}
